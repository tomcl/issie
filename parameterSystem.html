<!DOCTYPE html>
<html lang="en" data-root="/issie/">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Main" name="author">
    <!-- Opengraph properties (https://ogp.me/) -->
    <meta property="og:site_name" content="issie">
    <meta property="og:title" content="Parameter System Documentation
" />
    <meta property="og:url" content="/issie/parameterSystem.html">
    <meta property="og:type" content="website" />
    <!-- Twitter cards (https://developer.twitter.com/en/docs/twitter-for-websites/cards/overview/summary-card-with-large-image) -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="/issie/">
    <meta name="twitter:title" content="Parameter System Documentation
">
    
    <title>Parameter System Documentation
 | issie</title>
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link crossorigin href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
    <link href="/issie/img/favicon.ico" rel="icon" sizes="32x32" type="image/png"/>
    <script type="application/javascript" src="/issie/content/fsdocs-theme-set-dark.js"></script>
    <script type="application/javascript" src="/issie/content/fsdocs-details-set-expanded.js"></script>
    <link href="/issie/content/fsdocs-default.css" rel="stylesheet" type="text/css"/>
    <link href="/issie/content/fsdocs-theme.css" rel="stylesheet" type="text/css"/>
    
    
</head>
<body class="content">
<header>
    <div class="start">
        <div id="menu-toggle">
            <iconify-icon class="icon closed" height="22" icon="eva:menu-fill" width="22"></iconify-icon>
            <iconify-icon class="icon open" height="22" icon="mi:close" width="22"></iconify-icon>
            <input type="checkbox" name="mobile-menu" />
            <ul class="menu">
                <li class="nav-header">Links</li>
                <li class="license-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/tomcl/issie/blob/master/LICENSE.md">License</a>
                </li>
                <li class="release-notes-menu-item builtin-menu-item nav-item"><a class="nav-link"
                                        href="https://github.com/tomcl/issie/releases/">Release
                    Notes</a></li>
                <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/tomcl/issie/">Source
                    Repository</a></li>
                <li class="nav-header ">
  Documentation
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/gettingStarted.html">
    Getting Started
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/userGuide.html">
    User Tutorial
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/coolFeatures.html">
    Schematic Editor Features
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/verilogComp.html">
    Verilog Components
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/verilogGenerate.html">
    Verilog Output
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/issiestick.html">
    ISSIE-Stick FPGA hardware
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/reports.html">
    Technical Reports
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/contact.html">
    Contacts
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/Updating the documentation.html">
    Updating This Documentation
  </a>
</li>             
<li class="nav-header active">
  Other
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/BUILD_OPTIMIZATION.html">
    Build Process Optimization Guide

  </a>
</li>             
<li class="nav-item active">
  <a class="nav-link" href="/issie/parameterSystem.html">
    Parameter System Documentation

  </a>
</li>             
<li class="nav-header ">
  Blog Updates
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2025-04-09-five-years.html">
    Five years of Issie
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2025-04-04-Issie-v5-9-3.html">
    ISSIE v5.9.3
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2024-09-25-Issie-v5-2-0.html">
    ISSIE v5.2.0
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2022-12-25-Issie-v3-0-9.html">
    ISSIE v3.0.9  - Happy Christmas!
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2022-09-20-Issie-v3-0-1.html">
    ISSIE v3.0.1
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2022-05-04-Issie-v3-0-0.html">
    ISSIE v3.0.0
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2021-07-04-Issie-v2-1-0.html">
    ISSIE v2.1.0
  </a>
</li>
                <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="/issie/reference/index.html">
    All Namespaces
  </a>
</li>
            </ul>
        </div>
        <a href="/issie/">
            <img alt="Header menu logo" src="/issie//issieIcon.png">
            <strong>issie</strong>
        </a>
    </div>
    <div class="end">
        <a href="https://github.com/tomcl/issie/" target="_blank">
            <iconify-icon icon="uil:github" width="26" height="26"></iconify-icon>
        </a>
        <iconify-icon id="search-btn" icon="carbon:search" class="search" width="24" height="24"></iconify-icon>
        <fsdocs-theme-toggle></fsdocs-theme-toggle>
    </div>
</header>
<aside id="fsdocs-main-menu">
    <ul class="menu">
        <li class="nav-header">Links</li>
        <li class="license-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/tomcl/issie/blob/master/LICENSE.md">License</a>
        </li>
        <li class="release-notes-menu-item builtin-menu-item nav-item"><a class="nav-link"
                                href="https://github.com/tomcl/issie/releases/">Release
            Notes</a></li>
        <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/tomcl/issie/">Source
            Repository</a></li>
        <li class="repository-menu-item builtin-menu-item nav-item"><a class="nav-link" href="https://github.com/tomcl/issie/wiki">Developers Wiki
                </a></li>
    
        <li class="nav-header ">
  Documentation
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/gettingStarted.html">
    Getting Started
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/userGuide.html">
    User Tutorial
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/coolFeatures.html">
    Schematic Editor Features
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/verilogComp.html">
    Verilog Components
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/verilogGenerate.html">
    Verilog Output
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/issiestick.html">
    ISSIE-Stick FPGA hardware
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/reports.html">
    Technical Reports
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/contact.html">
    Contacts
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/Updating the documentation.html">
    Updating This Documentation
  </a>
</li>             
<li class="nav-header active">
  Other
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/BUILD_OPTIMIZATION.html">
    Build Process Optimization Guide

  </a>
</li>             
<li class="nav-item active">
  <a class="nav-link" href="/issie/parameterSystem.html">
    Parameter System Documentation

  </a>
</li>             
<li class="nav-header ">
  Blog Updates
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2025-04-09-five-years.html">
    Five years of Issie
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2025-04-04-Issie-v5-9-3.html">
    ISSIE v5.9.3
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2024-09-25-Issie-v5-2-0.html">
    ISSIE v5.2.0
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2022-12-25-Issie-v3-0-9.html">
    ISSIE v3.0.9  - Happy Christmas!
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2022-09-20-Issie-v3-0-1.html">
    ISSIE v3.0.1
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2022-05-04-Issie-v3-0-0.html">
    ISSIE v3.0.0
  </a>
</li>             
<li class="nav-item ">
  <a class="nav-link" href="/issie/updates/2021-07-04-Issie-v2-1-0.html">
    ISSIE v2.1.0
  </a>
</li>
        <li class="nav-header">
  API Reference
</li>             
<li class="nav-item">
  <a class="nav-link" href="/issie/reference/index.html">
    All Namespaces
  </a>
</li>
    </ul>
</aside>
<main>
    <div id="content">
        <h1><a name="Parameter-System-Documentation" class="anchor" href="#Parameter-System-Documentation">Parameter System Documentation</a></h1>
<h2><a name="Overview" class="anchor" href="#Overview">Overview</a></h2>
<p>The parameter system in Issie allows users to define symbolic integer parameters on design sheets and use them in mathematical expressions to configure component properties. This enables parameterized component design where values can be dynamically calculated based on parameter bindings rather than being hardcoded. The system supports hierarchical parameter scoping and instance-specific parameter overrides.</p>
<h2><a name="Key-Features" class="anchor" href="#Key-Features">Key Features</a></h2>
<ul>
<li><strong>Symbolic Parameters</strong>: Define named integer parameters (e.g., <code>WIDTH</code>, <code>SIZE</code>) at the sheet level</li>
<li><strong>Expression Language</strong>: Use arithmetic expressions (<code>WIDTH + 1</code>, <code>SIZE * 8</code>) to calculate values</li>
<li><strong>Hierarchical Scoping</strong>: Parameters defined at sheet level, overridable per component instance</li>
<li><strong>Constraint System</strong>: Define min/max constraints on parameter values with custom error messages</li>
<li><strong>Custom Component Support</strong>: Pass parameters between sheets through custom components</li>
<li><strong>Real-time Evaluation</strong>: Expressions evaluated dynamically as parameters change</li>
</ul>
<h2><a name="Architecture" class="anchor" href="#Architecture">Architecture</a></h2>
<p>The parameter system is implemented across several key modules with clear separation of concerns:</p>
<h3><a name="Core-Data-Types" class="anchor" href="#Core-Data-Types">Core Data Types (<code>ParameterTypes.fs</code>)</a></h3>
<p>The parameter system's foundation is built on these core types:</p>
<h4><a name="Basic-Types" class="anchor" href="#Basic-Types">Basic Types</a></h4>
<ul>
<li>*<em><code>ParamInt</code>*</em>: Currently <code>int</code>, will be extended to <code>bigint</code> for large bit constants</li>
<li>*<em><code>ParamName</code>*</em>: Encapsulated string representing a parameter identifier</li>
</ul>
<h4><a name="Expression-AST" class="anchor" href="#Expression-AST">Expression AST</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="rt">ParamExpression</span> <span class="o">=</span>
    <span class="pn">|</span> <span class="uc">PInt</span> <span class="k">of</span> <span class="id">ParamInt</span>                              <span class="c">// Integer constant</span>
    <span class="pn">|</span> <span class="uc">PParameter</span> <span class="k">of</span> <span class="id">ParamName</span>                       <span class="c">// Parameter reference</span>
    <span class="pn">|</span> <span class="uc">PAdd</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="rt">ParamExpression</span> <span class="pn">*</span> <span onmouseout="hideTip(event, 'fs1', 3)" onmouseover="showTip(event, 'fs1', 3)" class="rt">ParamExpression</span>     <span class="c">// Addition</span>
    <span class="pn">|</span> <span class="uc">PSubtract</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 4)" onmouseover="showTip(event, 'fs1', 4)" class="rt">ParamExpression</span> <span class="pn">*</span> <span onmouseout="hideTip(event, 'fs1', 5)" onmouseover="showTip(event, 'fs1', 5)" class="rt">ParamExpression</span> <span class="c">// Subtraction</span>
    <span class="pn">|</span> <span class="uc">PMultiply</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 6)" onmouseover="showTip(event, 'fs1', 6)" class="rt">ParamExpression</span> <span class="pn">*</span> <span onmouseout="hideTip(event, 'fs1', 7)" onmouseover="showTip(event, 'fs1', 7)" class="rt">ParamExpression</span> <span class="c">// Multiplication</span>
    <span class="pn">|</span> <span class="uc">PDivide</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 8)" onmouseover="showTip(event, 'fs1', 8)" class="rt">ParamExpression</span> <span class="pn">*</span> <span onmouseout="hideTip(event, 'fs1', 9)" onmouseover="showTip(event, 'fs1', 9)" class="rt">ParamExpression</span>  <span class="c">// Division</span>
    <span class="pn">|</span> <span class="uc">PRemainder</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 10)" onmouseover="showTip(event, 'fs1', 10)" class="rt">ParamExpression</span> <span class="pn">*</span> <span onmouseout="hideTip(event, 'fs1', 11)" onmouseover="showTip(event, 'fs1', 11)" class="rt">ParamExpression</span> <span class="c">// Modulo</span>
</code></pre>
<h4><a name="Constraints" class="anchor" href="#Constraints">Constraints</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs2', 12)" onmouseover="showTip(event, 'fs2', 12)" class="rt">ParamConstraint</span> <span class="o">=</span>
    <span class="pn">|</span> <span class="uc">MinVal</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 13)" onmouseover="showTip(event, 'fs1', 13)" class="rt">ParamExpression</span> <span class="pn">*</span> <span class="id">ParamError</span>  <span class="c">// Minimum value constraint</span>
    <span class="pn">|</span> <span class="uc">MaxVal</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 14)" onmouseover="showTip(event, 'fs1', 14)" class="rt">ParamExpression</span> <span class="pn">*</span> <span class="id">ParamError</span>  <span class="c">// Maximum value constraint</span>
</code></pre>
<h4><a name="Component-Slots" class="anchor" href="#Component-Slots">Component Slots</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs3', 15)" onmouseover="showTip(event, 'fs3', 15)" class="rt">CompSlotName</span> <span class="o">=</span>
    <span class="pn">|</span> <span class="uc">Buswidth</span>              <span class="c">// Component bus width</span>
    <span class="pn">|</span> <span class="uc">NGateInputs</span>           <span class="c">// Number of gate inputs</span>
    <span class="pn">|</span> <span class="uc">IO</span> <span class="k">of</span> <span class="prop">Label</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs4', 16)" onmouseover="showTip(event, 'fs4', 16)" class="rt">string</span>   <span class="c">// Input/Output port widths</span>
    <span class="pn">|</span> <span class="uc">CustomCompParam</span> <span class="k">of</span> <span class="prop">ParamName</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs4', 17)" onmouseover="showTip(event, 'fs4', 17)" class="rt">string</span> <span class="c">// Custom component parameters</span>
</code></pre>
<h4><a name="Sheet-Level-Definitions" class="anchor" href="#Sheet-Level-Definitions">Sheet-Level Definitions</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs5', 18)" onmouseover="showTip(event, 'fs5', 18)" class="rt">ParameterDefs</span> <span class="o">=</span> <span class="pn">{</span>
    <span class="prop">DefaultBindings</span><span class="pn">:</span> <span class="id">ParamBindings</span>  <span class="c">// Parameter name to expression mappings</span>
    <span class="prop">ParamSlots</span><span class="pn">:</span> <span class="id">ComponentSlotExpr</span>   <span class="c">// Component slots bound to expressions</span>
<span class="pn">}</span>
</code></pre>
<h3><a name="UI-Layer" class="anchor" href="#UI-Layer">UI Layer (<code>ParameterView.fs</code>)</a></h3>
<p>Manages all parameter-related user interactions:</p>
<h4><a name="Sheet-Parameter-Management" class="anchor" href="#Sheet-Parameter-Management">Sheet Parameter Management</a></h4>
<ul>
<li>*<em><code>addParameterBox</code>*</em>: Create new sheet parameters via popup dialog</li>
<li>*<em><code>editParameterBox</code>*</em>: Modify existing parameter values</li>
<li>*<em><code>deleteParameterBox</code>*</em>: Remove parameters from sheet</li>
<li>*<em><code>makeParamsField</code>*</em>: Display sheet parameters in properties panel</li>
</ul>
<h4><a name="Component-Parameter-Binding" class="anchor" href="#Component-Parameter-Binding">Component Parameter Binding</a></h4>
<ul>
<li>*<em><code>paramInputField</code>*</em>: Generic input field supporting parameter expressions</li>
<li>*<em><code>makeParamBindingEntryBoxes</code>*</em>: UI for custom component parameter bindings</li>
<li>*<em><code>editParameterBindingPopup</code>*</em>: Edit instance-specific parameter values</li>
<li>*<em><code>updateComponent</code>*</em>: Apply parameter changes to components via Sheet messages</li>
</ul>
<h4><a name="Parameter-Evaluation" class="anchor" href="#Parameter-Evaluation">Parameter Evaluation</a></h4>
<ul>
<li>*<em><code>evaluateConstraints</code>*</em>: Validate expressions against constraints</li>
<li>*<em><code>updateComponents</code>*</em>: Batch update all parameterized components</li>
<li>*<em><code>resolveParametersForComponent</code>*</em>: Resolve parameters for simulation</li>
</ul>
<h3><a name="Simulation-Integration" class="anchor" href="#Simulation-Integration">Simulation Integration (<code>GraphMerger.fs</code>)</a></h3>
<p>Handles parameter resolution during simulation graph construction using a two-stage process:</p>
<h4><a name="Stage-1-Graph-Merging" class="anchor" href="#Stage-1-Graph-Merging">Stage 1 - Graph Merging</a></h4>
<ul>
<li>Custom components replaced with internal graphs</li>
<li>Parameter resolution intentionally deferred to avoid forward references</li>
<li>Graphs stored in <code>CustomSimulationGraph</code> field</li>
</ul>
<h4><a name="Stage-2-Parameter-Resolution" class="anchor" href="#Stage-2-Parameter-Resolution">Stage 2 - Parameter Resolution</a></h4>
<p><strong>2a. Instance-specific</strong> (<code>resolveCustomComponentParameters</code>):
- Apply component instance parameter bindings
- Override default values from definitions
- Process nested custom components recursively</p>
<p><strong>2b. Sheet-level</strong> (<code>resolveParametersInSimulationGraph</code>):
- Use default sheet parameter bindings
- Evaluate expressions for all parameterized slots
- Update component configurations with resolved values</p>
<p>This two-stage approach prevents forward reference issues and ensures proper parameter precedence.</p>
<h3><a name="Validation-Layer" class="anchor" href="#Validation-Layer">Validation Layer (<code>CanvasStateAnalyser.fs</code>)</a></h3>
<p>Provides lightweight parameter resolution for component validation:
- Simplified evaluator supporting only <code>PInt</code> and <code>PParameter</code>
- Resolves I/O port widths for label extraction
- Optimized for validation performance</p>
<h3><a name="Component-Creation" class="anchor" href="#Component-Creation">Component Creation (<code>CatalogueView.fs</code>)</a></h3>
<p>Integrates parameters during component instantiation:
- Merges parent sheet parameters with component defaults
- Resolves parameters before extracting port labels
- Passes parameter bindings to custom components
- Creates parameter input dialogs for component properties</p>
<h2><a name="Data-Flow" class="anchor" href="#Data-Flow">Data Flow</a></h2>
<h3><a name="1-Parameter-Definition-Flow" class="anchor" href="#1-Parameter-Definition-Flow">1. Parameter Definition Flow</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">User</span> <span class="id">Input</span> <span class="pn">(</span><span class="id">Properties</span> <span class="id">Panel</span><span class="pn">)</span>
    
<span class="id">ParameterView</span><span class="pn">.</span><span class="id">addParameterBox</span>
    
<span class="id">ParameterTypes</span><span class="pn">.</span><span class="id">parseExpression</span> <span class="pn">(</span><span class="id">validate</span> <span class="id">syntax</span><span class="pn">)</span>
    
<span class="id">Update</span> <span class="id">Model</span><span class="pn">.</span><span class="id">LoadedComponent</span><span class="pn">.</span><span class="id">LCParameterSlots</span>
    
<span class="id">Persist</span> <span class="k">to</span> <span class="pn">.</span><span class="id">dgm</span> <span class="id">file</span>
</code></pre>
<h3><a name="2-Component-Parameterization-Flow" class="anchor" href="#2-Component-Parameterization-Flow">2. Component Parameterization Flow</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">User</span> <span class="id">selects</span> <span class="id">component</span> <span class="id">property</span>
    
<span class="id">ParameterView</span><span class="pn">.</span><span class="id">paramInputField</span>
    
<span class="id">Parse</span> <span class="o">&amp;</span> <span class="id">evaluate</span> <span class="id">expression</span>
    
<span class="id">Check</span> <span class="id">constraints</span>
    
<span class="id">Update</span> <span class="id">ComponentSlotExpr</span> <span class="id">map</span>
    
<span class="id">Apply</span> <span class="k">to</span> <span class="id">component</span> <span class="id">via</span> <span class="id">Sheet</span> <span class="id">messages</span>
</code></pre>
<h3><a name="3-Simulation-Resolution-Flow" class="anchor" href="#3-Simulation-Resolution-Flow">3. Simulation Resolution Flow</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Simulation</span> <span class="id">Start</span>
    
<span class="id">GraphMerger</span><span class="pn">.</span><span class="id">mergeDependencies</span>
    
<span class="id">Stage</span> <span class="n">1</span><span class="pn">:</span> <span class="id">Merge</span> <span class="id">graphs</span> <span class="pn">(</span><span class="id">defer</span> <span class="id">parameters</span><span class="pn">)</span>
    
<span class="id">Stage</span> <span class="n">2a</span><span class="pn">:</span> <span class="id">Resolve</span> <span class="id">instance</span> <span class="id">parameters</span>
    
<span class="id">Stage</span> <span class="n">2b</span><span class="pn">:</span> <span class="id">Resolve</span> <span class="id">sheet</span> <span class="id">parameters</span>
    
<span class="id">FastSim</span> <span class="k">with</span> <span class="id">resolved</span> <span class="id">values</span>
</code></pre>
<h3><a name="4-Custom-Component-Flow" class="anchor" href="#4-Custom-Component-Flow">4. Custom Component Flow</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Parent</span> <span class="id">Sheet</span> <span class="id">Parameters</span>
    
<span class="id">Merge</span> <span class="k">with</span> <span class="id">Component</span> <span class="id">Defaults</span>
    
<span class="id">Resolve</span> <span class="id">Canvas</span> <span class="id">State</span>
    
<span class="id">Extract</span> <span class="id">Port</span> <span class="id">Labels</span>
    
<span class="id">Create</span> <span class="id">Custom</span> <span class="id">Component</span> <span class="id">Instance</span>
</code></pre>
<h2><a name="Expression-Language" class="anchor" href="#Expression-Language">Expression Language</a></h2>
<p>The parameter expression parser supports:</p>
<h3><a name="Syntax-Elements" class="anchor" href="#Syntax-Elements">Syntax Elements</a></h3>
<ul>
<li><strong>Literals</strong>: Integer constants (e.g., <code>8</code>, <code>32</code>)</li>
<li><strong>Variables</strong>: Alphanumeric parameter names (e.g., <code>WIDTH</code>, <code>dataSize</code>)</li>
<li>
<strong>Operators</strong> (with precedence):
<ul>
<li>Multiplication, Division, Modulo: <code>*</code>, <code>/</code>, <code>%</code> (higher precedence)</li>
<li>Addition, Subtraction: <code>+</code>, <code>-</code> (lower precedence)</li>
</ul>
</li>
<li><strong>Parentheses</strong>: For grouping expressions</li>
</ul>
<h3><a name="Example-Expressions" class="anchor" href="#Example-Expressions">Example Expressions</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">WIDTH</span>           <span class="c">// Simple parameter reference</span>
<span class="id">WIDTH</span> <span class="o">+</span> <span class="n">1</span>       <span class="c">// Increment parameter</span>
<span class="pn">(</span><span class="id">n</span> <span class="pn">*</span> <span class="n">8</span><span class="pn">)</span> <span class="o">-</span> <span class="n">1</span>     <span class="c">// Complex calculation</span>
<span class="id">baseAddr</span> <span class="o">+</span> <span class="pn">(</span><span class="id">offset</span> <span class="pn">*</span> <span class="n">4</span><span class="pn">)</span>  <span class="c">// Address calculation</span>
<span class="id">WIDTH</span> <span class="o">/</span> <span class="n">2</span>       <span class="c">// Division</span>
<span class="id">SIZE</span> <span class="o">%</span> <span class="n">8</span>        <span class="c">// Modulo operation</span>
</code></pre>
<h3><a name="Parser-Implementation" class="anchor" href="#Parser-Implementation">Parser Implementation</a></h3>
<p>The parser uses recursive descent with separate functions for each precedence level:
- <code>parsePrimary</code>: Handles numbers, variables, and parentheses
- <code>parseFactors</code>: Processes multiplication, division, modulo
- <code>parseExpressionTokens</code>: Handles addition and subtraction</p>
<h2><a name="Parameter-Scoping-amp-Precedence" class="anchor" href="#Parameter-Scoping-amp-Precedence">Parameter Scoping &amp; Precedence</a></h2>
<h3><a name="Scope-Levels" class="anchor" href="#Scope-Levels">Scope Levels</a></h3>
<ol>
<li><strong>Sheet-level parameters</strong>: Defined in sheet properties, scope limited to that sheet</li>
<li><strong>Instance parameters</strong>: Override sheet defaults for specific component instances</li>
<li><strong>Custom component parameters</strong>: Inherited from parent sheet, can be overridden per instance</li>
</ol>
<h3><a name="Precedence-Rules-highest-to-lowest" class="anchor" href="#Precedence-Rules-highest-to-lowest">Precedence Rules (highest to lowest)</a></h3>
<ol>
<li>Instance-specific bindings</li>
<li>Parent sheet parameters</li>
<li>Component default parameters</li>
</ol>
<h3><a name="Example-Scenario" class="anchor" href="#Example-Scenario">Example Scenario</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Sheet</span> <span class="id">A</span> <span class="id">defines</span><span class="pn">:</span> <span class="id">WIDTH</span> <span class="o">=</span> <span class="n">8</span>
<span class="id">Custom</span> <span class="id">Component</span> <span class="id">B</span> <span class="id">has</span> <span class="k">default</span><span class="pn">:</span> <span class="id">WIDTH</span> <span class="o">=</span> <span class="n">16</span>
<span class="id">Instance</span> <span class="k">of</span> <span class="id">B</span> <span class="k">in</span> <span class="id">A</span> <span class="k">with</span> <span class="k">override</span><span class="pn">:</span> <span class="id">WIDTH</span> <span class="o">=</span> <span class="n">32</span>

<span onmouseout="hideTip(event, 'fs6', 19)" onmouseover="showTip(event, 'fs6', 19)" class="id">Result</span><span class="pn">:</span> <span class="id">Instance</span> <span class="id">uses</span> <span class="id">WIDTH</span> <span class="o">=</span> <span class="n">32</span>
</code></pre>
<h2><a name="Constraint-System" class="anchor" href="#Constraint-System">Constraint System</a></h2>
<p>Constraints ensure parameter values remain within valid ranges:</p>
<h3><a name="Constraint-Definition" class="anchor" href="#Constraint-Definition">Constraint Definition</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">type</span> <span onmouseout="hideTip(event, 'fs2', 20)" onmouseover="showTip(event, 'fs2', 20)" class="id">ParamConstraint</span> <span class="o">=</span>
    <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs7', 21)" onmouseover="showTip(event, 'fs7', 21)" class="id">MinVal</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 22)" onmouseover="showTip(event, 'fs1', 22)" class="id">ParamExpression</span> <span class="pn">*</span> <span class="id">ParamError</span>
    <span class="pn">|</span> <span onmouseout="hideTip(event, 'fs8', 23)" onmouseover="showTip(event, 'fs8', 23)" class="id">MaxVal</span> <span class="k">of</span> <span onmouseout="hideTip(event, 'fs1', 24)" onmouseover="showTip(event, 'fs1', 24)" class="id">ParamExpression</span> <span class="pn">*</span> <span class="id">ParamError</span>
</code></pre>
<h3><a name="Features" class="anchor" href="#Features">Features</a></h3>
<ul>
<li>Evaluated during input validation</li>
<li>Checked before component updates</li>
<li>Display custom error messages when violated</li>
<li>Support expressions in constraint definitions</li>
</ul>
<h3><a name="Example" class="anchor" href="#Example">Example</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="id">widthConstraints</span> <span class="o">=</span> <span class="pn">[</span>
    <span onmouseout="hideTip(event, 'fs7', 25)" onmouseover="showTip(event, 'fs7', 25)" class="id">MinVal</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs9', 26)" onmouseover="showTip(event, 'fs9', 26)" class="id">PInt</span> <span class="n">1</span><span class="pn">,</span> <span class="s">&quot;Width must be at least 1 bit&quot;</span><span class="pn">)</span>
    <span onmouseout="hideTip(event, 'fs8', 27)" onmouseover="showTip(event, 'fs8', 27)" class="id">MaxVal</span> <span class="pn">(</span><span onmouseout="hideTip(event, 'fs9', 28)" onmouseover="showTip(event, 'fs9', 28)" class="id">PInt</span> <span class="n">64</span><span class="pn">,</span> <span class="s">&quot;Width cannot exceed 64 bits&quot;</span><span class="pn">)</span>
<span class="pn">]</span>
</code></pre>
<h2><a name="Three-Tier-Evaluation-Architecture" class="anchor" href="#Three-Tier-Evaluation-Architecture">Three-Tier Evaluation Architecture</a></h2>
<p>The system implements three evaluation strategies optimized for different contexts:</p>
<h3><a name="1-Full-Resolution" class="anchor" href="#1-Full-Resolution">1. Full Resolution (<code>ParameterTypes.evaluateParamExpression</code>)</a></h3>
<ul>
<li><strong>Purpose</strong>: User interface feedback</li>
<li>
<strong>Features</strong>:
<ul>
<li>Complete arithmetic support</li>
<li>Detailed error messages</li>
<li>Returns <code>Result&lt;int, string&gt;</code></li>
</ul>
</li>
<li><strong>Usage</strong>: Parameter input fields, validation messages</li>
</ul>
<h3><a name="2-Graph-Resolution" class="anchor" href="#2-Graph-Resolution">2. Graph Resolution (<code>GraphMerger.evalExpr</code>)</a></h3>
<ul>
<li><strong>Purpose</strong>: Simulation graph construction</li>
<li>
<strong>Features</strong>:
<ul>
<li>Returns <code>Option&lt;int&gt;</code> instead of <code>Result</code></li>
<li>Optimized for batch processing</li>
<li>No error messages needed</li>
</ul>
</li>
<li><strong>Usage</strong>: Simulation preparation</li>
</ul>
<h3><a name="3-Validation-Resolution" class="anchor" href="#3-Validation-Resolution">3. Validation Resolution (<code>CanvasStateAnalyser</code>)</a></h3>
<ul>
<li><strong>Purpose</strong>: Quick validation checks</li>
<li>
<strong>Features</strong>:
<ul>
<li>Minimal evaluator (PInt, PParameter only)</li>
<li>Just for I/O port widths</li>
<li>Maximum performance</li>
</ul>
</li>
<li><strong>Usage</strong>: Component validation</li>
</ul>
<h2><a name="Persistence" class="anchor" href="#Persistence">Persistence</a></h2>
<p>Parameter data is stored across multiple locations:</p>
<h3><a name="File-Storage" class="anchor" href="#File-Storage">File Storage</a></h3>
<ul>
<li>
*<em><code>.dgm</code> files*</em>: Sheet parameter definitions and slot bindings
<ul>
<li>Stored in <code>LCParameterSlots</code> field of LoadedComponent</li>
<li>JSON serialization of ParameterDefs type</li>
</ul>
</li>
</ul>
<h3><a name="Runtime-State" class="anchor" href="#Runtime-State">Runtime State</a></h3>
<ul>
<li><strong>Model.LoadedComponent</strong>: Current parameter values</li>
<li><strong>Component.Type</strong>: Resolved parameter values in components</li>
<li><strong>CustomComponentType.ParameterBindings</strong>: Instance overrides</li>
</ul>
<h2><a name="Component-Support" class="anchor" href="#Component-Support">Component Support</a></h2>
<h3><a name="Currently-Parameterizable-Components" class="anchor" href="#Currently-Parameterizable-Components">Currently Parameterizable Components</a></h3>
<h4><a name="Width-Configurable-Components" class="anchor" href="#Width-Configurable-Components">Width-Configurable Components</a></h4>
<ul>
<li>Registers (<code>Register</code>, <code>RegisterE</code>)</li>
<li>Adders (<code>NbitsAdder</code>, <code>NbitsAdderNoCin</code>, etc.)</li>
<li>Logic Gates (<code>NbitsAnd</code>, <code>NbitsOr</code>, <code>NbitsNot</code>)</li>
<li>Multiplexers and Demultiplexers</li>
<li>Bus components (<code>BusCompare</code>, <code>BusSelection</code>)</li>
<li>Counters (all variants)</li>
</ul>
<h4><a name="Custom-Components" class="anchor" href="#Custom-Components">Custom Components</a></h4>
<ul>
<li>All parameters from component definition</li>
<li>Dynamic port width calculation</li>
<li>Hierarchical parameter passing</li>
</ul>
<h4><a name="I-O-Components" class="anchor" href="#I-O-Components">I/O Components</a></h4>
<ul>
<li>Input port widths (<code>Input</code>, <code>Input1</code>)</li>
<li>Output port widths (<code>Output</code>)</li>
</ul>
<h4><a name="Constants" class="anchor" href="#Constants">Constants</a></h4>
<ul>
<li>Bit width specification (<code>Constant</code>, <code>Constant1</code>)</li>
</ul>
<h3><a name="Adding-Parameter-Support-to-New-Components" class="anchor" href="#Adding-Parameter-Support-to-New-Components">Adding Parameter Support to New Components</a></h3>
<ol>
<li>Add case to <code>compSlot_</code> lens in ParameterView.fs</li>
<li>Update component type in CommonTypes.fs</li>
<li>Add UI support in component properties</li>
<li>Handle in simulation resolution</li>
</ol>
<h2><a name="Usage-Examples" class="anchor" href="#Usage-Examples">Usage Examples</a></h2>
<h3><a name="Example-1-Define-Sheet-Parameter" class="anchor" href="#Example-1-Define-Sheet-Parameter">Example 1: Define Sheet Parameter</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// User adds parameter &quot;WIDTH&quot; with value 8</span>
<span class="n">1.</span> <span class="id">Open</span> <span class="id">sheet</span> <span class="id">properties</span> <span class="id">panel</span>
<span class="n">2.</span> <span class="id">Click</span> <span class="s">&quot;Add Parameter&quot;</span>
<span class="n">3.</span> <span class="id">Enter</span> <span class="id">name</span><span class="pn">:</span> <span class="s">&quot;WIDTH&quot;</span>
<span class="n">4.</span> <span class="id">Enter</span> <span class="id">value</span><span class="pn">:</span> <span class="n">8</span>
<span class="n">5.</span> <span class="id">Parameter</span> <span class="id">available</span> <span class="k">for</span> <span class="k">use</span> <span class="k">in</span> <span class="id">expressions</span>
</code></pre>
<h3><a name="Example-2-Use-Parameter-in-Component" class="anchor" href="#Example-2-Use-Parameter-in-Component">Example 2: Use Parameter in Component</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Configure Register with parameterized width</span>
<span class="n">1.</span> <span class="id">Add</span> <span class="id">Register</span> <span class="id">component</span> <span class="k">to</span> <span class="id">sheet</span>
<span class="n">2.</span> <span class="id">Select</span> <span class="id">Register</span>
<span class="n">3.</span> <span class="id">In</span> <span class="id">properties</span><span class="pn">,</span> <span class="id">enter</span> <span class="id">bus</span> <span class="id">width</span><span class="pn">:</span> <span class="s">&quot;WIDTH&quot;</span>
<span class="n">4.</span> <span onmouseout="hideTip(event, 'fs10', 29)" onmouseover="showTip(event, 'fs10', 29)" class="id">System</span> <span class="id">evaluates</span> <span class="k">to</span> <span class="n">8</span>
<span class="n">5.</span> <span class="id">Change</span> <span class="id">WIDTH</span> <span class="id">parameter</span> 
</code></pre>
<h3><a name="Example-3-Override-in-Custom-Component" class="anchor" href="#Example-3-Override-in-Custom-Component">Example 3: Override in Custom Component</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Custom component with parameter override</span>
<span class="n">1.</span> <span class="id">Create</span> <span class="id">custom</span> <span class="id">component</span> <span class="id">from</span> <span class="id">sheet</span> <span class="k">with</span> <span class="id">WIDTH</span> <span class="id">parameter</span>
<span class="n">2.</span> <span class="id">Place</span> <span class="id">instance</span> <span class="k">in</span> <span class="id">parent</span> <span class="id">sheet</span>
<span class="n">3.</span> <span class="id">Select</span> <span class="id">instance</span>
<span class="n">4.</span> <span class="id">Edit</span> <span class="id">parameter</span> <span class="id">binding</span><span class="pn">:</span> <span class="id">WIDTH</span> <span class="o">=</span> <span class="s">&quot;parentWidth * 2&quot;</span>
<span class="n">5.</span> <span class="id">Instance</span> <span class="id">uses</span> <span class="id">calculated</span> <span class="id">value</span>
</code></pre>
<h3><a name="Example-4-Complex-Expression" class="anchor" href="#Example-4-Complex-Expression">Example 4: Complex Expression</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Address decoder with calculated ranges</span>
<span class="n">1.</span> <span class="id">Define</span> <span class="id">parameters</span><span class="pn">:</span> <span class="id">BASE_ADDR</span> <span class="o">=</span> <span class="n">0x1000</span><span class="pn">,</span> <span class="id">BLOCK_SIZE</span> <span class="o">=</span> <span class="n">256</span>
<span class="n">2.</span> <span class="id">Create</span> <span class="id">comparator</span> <span class="k">with</span> <span class="id">expression</span><span class="pn">:</span> <span class="s">&quot;BASE_ADDR + (BLOCK_SIZE * 4)&quot;</span>
<span class="n">3.</span> <span onmouseout="hideTip(event, 'fs10', 30)" onmouseover="showTip(event, 'fs10', 30)" class="id">System</span> <span class="id">evaluates</span> <span class="k">to</span> <span class="n">0x1400</span>
</code></pre>
<h2><a name="Error-Handling" class="anchor" href="#Error-Handling">Error Handling</a></h2>
<p>The system provides comprehensive error handling at multiple levels:</p>
<h3><a name="Parse-Errors" class="anchor" href="#Parse-Errors">Parse Errors</a></h3>
<ul>
<li><strong>Invalid syntax</strong>: "Contains unsupported characters: [']'"</li>
<li><strong>Empty input</strong>: "Input Empty"</li>
<li><strong>Unmatched parentheses</strong>: "Mismatched parentheses"</li>
</ul>
<h3><a name="Evaluation-Errors" class="anchor" href="#Evaluation-Errors">Evaluation Errors</a></h3>
<ul>
<li><strong>Undefined parameters</strong>: "Parameter 'X' is not defined"</li>
<li><strong>Multiple undefined</strong>: "Parameters X, Y, Z are not defined"</li>
</ul>
<h3><a name="Constraint-Violations" class="anchor" href="#Constraint-Violations">Constraint Violations</a></h3>
<ul>
<li><strong>Value too small</strong>: Custom message from MinVal constraint</li>
<li><strong>Value too large</strong>: Custom message from MaxVal constraint</li>
</ul>
<h3><a name="Type-Errors" class="anchor" href="#Type-Errors">Type Errors</a></h3>
<ul>
<li><strong>Invalid component</strong>: "Invalid component [Type] for buswidth"</li>
<li><strong>Wrong slot type</strong>: "CustomCompParam can only be used with Custom components"</li>
</ul>
<h2><a name="Implementation-Details" class="anchor" href="#Implementation-Details">Implementation Details</a></h2>
<h3><a name="Optics-Lenses-Pattern" class="anchor" href="#Optics-Lenses-Pattern">Optics/Lenses Pattern</a></h3>
<p>The system uses functional lenses for immutable state updates:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="k">let</span> <span class="id">paramSlotsOfModel_</span> <span class="o">=</span> 
    <span class="id">lcParameterInfoOfModel_</span> <span class="pn">&gt;</span><span class="o">?&gt;</span> <span class="id">paramSlots_</span>

<span class="id">model</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs11', 31)" onmouseover="showTip(event, 'fs11', 31)" class="id">set</span> <span class="id">paramSlotsOfModel_</span> <span class="id">newSlots</span>
</code></pre>
<h3><a name="Message-Dispatch" class="anchor" href="#Message-Dispatch">Message Dispatch</a></h3>
<p>State changes flow through Elmish messages:</p>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">Sheet</span> <span class="pn">(</span><span class="id">SheetT</span><span class="pn">.</span><span class="id">Wire</span> <span class="pn">(</span><span class="id">BusWireT</span><span class="pn">.</span><span class="id">Symbol</span> <span class="pn">(</span><span class="id">SymbolT</span><span class="pn">.</span><span class="id">ChangeWidth</span> <span class="o">..</span><span class="pn">.</span><span class="pn">)</span><span class="pn">)</span><span class="pn">)</span>
</code></pre>
<h3><a name="Functional-Patterns" class="anchor" href="#Functional-Patterns">Functional Patterns</a></h3>
<ul>
<li>Immutable data structures throughout</li>
<li>Pattern matching for control flow</li>
<li>Option/Result types for error handling</li>
<li>Pipeline operators for composition</li>
</ul>
<h2><a name="Testing-amp-Debugging" class="anchor" href="#Testing-amp-Debugging">Testing &amp; Debugging</a></h2>
<h3><a name="Debug-Helpers" class="anchor" href="#Debug-Helpers">Debug Helpers</a></h3>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="c">// Enable parameter debug tracing</span>
<span class="k">if</span> <span onmouseout="hideTip(event, 'fs12', 32)" onmouseover="showTip(event, 'fs12', 32)" class="id">Set</span><span class="pn">.</span><span onmouseout="hideTip(event, 'fs13', 33)" onmouseover="showTip(event, 'fs13', 33)" class="id">contains</span> <span class="s">&quot;params&quot;</span> <span class="id">JSHelpers</span><span class="pn">.</span><span class="id">debugTraceUI</span> <span class="k">then</span>
    <span onmouseout="hideTip(event, 'fs14', 34)" onmouseover="showTip(event, 'fs14', 34)" class="id">printfn</span> <span class="s">&quot;Parameter evaluation: %A -&gt; %A&quot;</span> <span class="id">expr</span> <span class="id">value</span>
</code></pre>
<h3><a name="Common-Issues" class="anchor" href="#Common-Issues">Common Issues</a></h3>
<ol>
<li><strong>Forward references</strong>: Resolved by two-stage simulation</li>
<li><strong>Circular dependencies</strong>: Detected and reported</li>
<li><strong>Constraint conflicts</strong>: Validated before application</li>
<li><strong>Type mismatches</strong>: Caught by F# type system</li>
</ol>
<h2><a name="Future-Extensions" class="anchor" href="#Future-Extensions">Future Extensions</a></h2>
<p>Potential enhancements identified in the codebase:</p>
<h3><a name="Type-System" class="anchor" href="#Type-System">Type System</a></h3>
<ul>
<li><strong>BigInt support</strong>: For constants &gt; 32 bits</li>
<li><strong>Float parameters</strong>: For analog simulations</li>
<li><strong>String parameters</strong>: For labels and identifiers</li>
</ul>
<h3><a name="Advanced-Features" class="anchor" href="#Advanced-Features">Advanced Features</a></h3>
<ul>
<li><strong>Parameter inheritance</strong>: Across sheet hierarchy</li>
<li><strong>Complex constraints</strong>: Relationships between parameters</li>
<li><strong>Expression optimization</strong>: Caching and simplification</li>
<li><strong>Parameter templates</strong>: Reusable parameter sets</li>
</ul>
<h3><a name="UI-Improvements" class="anchor" href="#UI-Improvements">UI Improvements</a></h3>
<ul>
<li><strong>Visual expression builder</strong>: Drag-drop interface</li>
<li><strong>Parameter preview</strong>: Real-time evaluation display</li>
<li><strong>Batch parameter updates</strong>: Apply to multiple components</li>
<li><strong>Parameter search</strong>: Find usage across project</li>
</ul>
<h2><a name="API-Reference" class="anchor" href="#API-Reference">API Reference</a></h2>
<h3><a name="Key-Functions" class="anchor" href="#Key-Functions">Key Functions</a></h3>
<h4><a name="Expression-Parsing" class="anchor" href="#Expression-Parsing">Expression Parsing</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">parseExpression</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs4', 35)" onmouseover="showTip(event, 'fs4', 35)" class="id">string</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 36)" onmouseover="showTip(event, 'fs6', 36)" class="id">Result</span><span class="pn">&lt;</span><span onmouseout="hideTip(event, 'fs1', 37)" onmouseover="showTip(event, 'fs1', 37)" class="id">ParamExpression</span><span class="pn">,</span> <span class="id">ParamError</span><span class="pn">&gt;</span>
</code></pre>
<h4><a name="Expression-Evaluation" class="anchor" href="#Expression-Evaluation">Expression Evaluation</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">evaluateParamExpression</span><span class="pn">:</span> <span class="id">ParamBindings</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs1', 38)" onmouseover="showTip(event, 'fs1', 38)" class="id">ParamExpression</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 39)" onmouseover="showTip(event, 'fs6', 39)" class="id">Result</span><span class="pn">&lt;</span><span class="id">ParamInt</span><span class="pn">,</span> <span class="id">ParamError</span><span class="pn">&gt;</span>
</code></pre>
<h4><a name="Expression-Rendering" class="anchor" href="#Expression-Rendering">Expression Rendering</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">renderParamExpression</span><span class="pn">:</span> <span onmouseout="hideTip(event, 'fs1', 40)" onmouseover="showTip(event, 'fs1', 40)" class="id">ParamExpression</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs15', 41)" onmouseover="showTip(event, 'fs15', 41)" class="id">int</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs4', 42)" onmouseover="showTip(event, 'fs4', 42)" class="id">string</span>
</code></pre>
<h4><a name="Parameter-Resolution" class="anchor" href="#Parameter-Resolution">Parameter Resolution</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">resolveParametersForComponent</span><span class="pn">:</span> <span class="id">ParamBindings</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs16', 43)" onmouseover="showTip(event, 'fs16', 43)" class="id">Map</span><span class="pn">&lt;</span><span class="id">ParamSlot</span><span class="pn">,</span> <span class="id">ConstrainedExpr</span><span class="pn">&gt;</span> <span class="k">-&gt;</span> <span class="id">Component</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 44)" onmouseover="showTip(event, 'fs6', 44)" class="id">Result</span><span class="pn">&lt;</span><span class="id">Component</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs4', 45)" onmouseover="showTip(event, 'fs4', 45)" class="id">string</span><span class="pn">&gt;</span>
</code></pre>
<h4><a name="Constraint-Checking" class="anchor" href="#Constraint-Checking">Constraint Checking</a></h4>
<pre class="fssnip highlighted"><code lang="fsharp"><span class="id">evaluateConstraints</span><span class="pn">:</span> <span class="id">ParamBindings</span> <span class="k">-&gt;</span> <span class="id">ConstrainedExpr</span> <span onmouseout="hideTip(event, 'fs17', 46)" onmouseover="showTip(event, 'fs17', 46)" class="id">list</span> <span class="k">-&gt;</span> <span class="pn">(</span><span class="id">Msg</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs18', 47)" onmouseover="showTip(event, 'fs18', 47)" class="id">unit</span><span class="pn">)</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs6', 48)" onmouseover="showTip(event, 'fs6', 48)" class="id">Result</span><span class="pn">&lt;</span><span class="id">Unit</span><span class="pn">,</span> <span onmouseout="hideTip(event, 'fs2', 49)" onmouseover="showTip(event, 'fs2', 49)" class="id">ParamConstraint</span> <span onmouseout="hideTip(event, 'fs17', 50)" onmouseover="showTip(event, 'fs17', 50)" class="id">list</span><span class="pn">&gt;</span>
</code></pre>
<h2><a name="Best-Practices" class="anchor" href="#Best-Practices">Best Practices</a></h2>
<ol>
<li><strong>Use descriptive parameter names</strong>: <code>DATA_WIDTH</code> instead of <code>W</code></li>
<li><strong>Define constraints early</strong>: Prevent invalid values at input time</li>
<li><strong>Document parameter meanings</strong>: In component descriptions</li>
<li><strong>Test edge cases</strong>: Min/max values, zero, negative numbers</li>
<li><strong>Keep expressions simple</strong>: Complex logic in simulation, not parameters</li>
<li><strong>Use consistent naming</strong>: Across sheets and components</li>
<li><strong>Validate before simulation</strong>: Check all parameters resolve correctly</li>
</ol>
<h2><a name="Troubleshooting" class="anchor" href="#Troubleshooting">Troubleshooting</a></h2>
<h3><a name="Parameter-Not-Found" class="anchor" href="#Parameter-Not-Found">Parameter Not Found</a></h3>
<ul>
<li>Check spelling of parameter name</li>
<li>Verify parameter is defined in current scope</li>
<li>Ensure proper capitalization (case-sensitive)</li>
</ul>
<h3><a name="Expression-Parse-Error" class="anchor" href="#Expression-Parse-Error">Expression Parse Error</a></h3>
<ul>
<li>Check for typos in operators</li>
<li>Verify parentheses are balanced</li>
<li>Use only supported operators (+, -, *, /, %)</li>
</ul>
<h3><a name="Constraint-Violation" class="anchor" href="#Constraint-Violation">Constraint Violation</a></h3>
<ul>
<li>Review constraint definitions</li>
<li>Check calculated values against limits</li>
<li>Adjust parameter values or constraints</li>
</ul>
<h3><a name="Simulation-Failure" class="anchor" href="#Simulation-Failure">Simulation Failure</a></h3>
<ul>
<li>Verify all parameters resolve to valid integers</li>
<li>Check for circular parameter dependencies</li>
<li>Ensure component types match parameter slots</li>
</ul>

        <div class="fsdocs-tip" id="fs1">type ParamExpression =
  | PInt of obj
  | PParameter of obj
  | PAdd of ParamExpression * ParamExpression
  | PSubtract of ParamExpression * ParamExpression
  | PMultiply of ParamExpression * ParamExpression
  | PDivide of ParamExpression * ParamExpression
  | PRemainder of ParamExpression * ParamExpression</div>
<div class="fsdocs-tip" id="fs2">type ParamConstraint =
  | MinVal of ParamExpression * obj
  | MaxVal of ParamExpression * obj</div>
<div class="fsdocs-tip" id="fs3">type CompSlotName =
  | Buswidth
  | NGateInputs
  | IO of Label: string
  | CustomCompParam of ParamName: string</div>
<div class="fsdocs-tip" id="fs4">Multiple items<br />val string: value: &#39;T -&gt; string<br /><br />--------------------<br />type string = System.String</div>
<div class="fsdocs-tip" id="fs5">type ParameterDefs =
  {
    DefaultBindings: obj
    ParamSlots: obj
  }</div>
<div class="fsdocs-tip" id="fs6">Multiple items<br />module Result

from Microsoft.FSharp.Core<br /><br />--------------------<br />[&lt;Struct&gt;]
type Result&lt;&#39;T,&#39;TError&gt; =
  | Ok of ResultValue: &#39;T
  | Error of ErrorValue: &#39;TError</div>
<div class="fsdocs-tip" id="fs7">union case ParamConstraint.MinVal: ParamExpression * obj -&gt; ParamConstraint</div>
<div class="fsdocs-tip" id="fs8">union case ParamConstraint.MaxVal: ParamExpression * obj -&gt; ParamConstraint</div>
<div class="fsdocs-tip" id="fs9">union case ParamExpression.PInt: obj -&gt; ParamExpression</div>
<div class="fsdocs-tip" id="fs10">namespace System</div>
<div class="fsdocs-tip" id="fs11">val set: elements: &#39;T seq -&gt; Set&lt;&#39;T&gt; (requires comparison)</div>
<div class="fsdocs-tip" id="fs12">Multiple items<br />module Set

from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Set&lt;&#39;T (requires comparison)&gt; =
  interface IReadOnlyCollection&lt;&#39;T&gt;
  interface IStructuralEquatable
  interface IComparable
  interface IEnumerable
  interface IEnumerable&lt;&#39;T&gt;
  interface ICollection&lt;&#39;T&gt;
  new: elements: &#39;T seq -&gt; Set&lt;&#39;T&gt;
  member Add: value: &#39;T -&gt; Set&lt;&#39;T&gt;
  member Contains: value: &#39;T -&gt; bool
  override Equals: obj -&gt; bool
  ...<br /><br />--------------------<br />new: elements: &#39;T seq -&gt; Set&lt;&#39;T&gt;</div>
<div class="fsdocs-tip" id="fs13">val contains: element: &#39;T -&gt; set: Set&lt;&#39;T&gt; -&gt; bool (requires comparison)</div>
<div class="fsdocs-tip" id="fs14">val printfn: format: Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T</div>
<div class="fsdocs-tip" id="fs15">Multiple items<br />val int: value: &#39;T -&gt; int (requires member op_Explicit)<br /><br />--------------------<br />type int = int32<br /><br />--------------------<br />type int&lt;&#39;Measure&gt; =
  int</div>
<div class="fsdocs-tip" id="fs16">Multiple items<br />module Map

from Microsoft.FSharp.Collections<br /><br />--------------------<br />type Map&lt;&#39;Key,&#39;Value (requires comparison)&gt; =
  interface IReadOnlyDictionary&lt;&#39;Key,&#39;Value&gt;
  interface IReadOnlyCollection&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;
  interface IEnumerable
  interface IStructuralEquatable
  interface IComparable
  interface IEnumerable&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;
  interface ICollection&lt;KeyValuePair&lt;&#39;Key,&#39;Value&gt;&gt;
  interface IDictionary&lt;&#39;Key,&#39;Value&gt;
  new: elements: (&#39;Key * &#39;Value) seq -&gt; Map&lt;&#39;Key,&#39;Value&gt;
  member Add: key: &#39;Key * value: &#39;Value -&gt; Map&lt;&#39;Key,&#39;Value&gt;
  ...<br /><br />--------------------<br />new: elements: (&#39;Key * &#39;Value) seq -&gt; Map&lt;&#39;Key,&#39;Value&gt;</div>
<div class="fsdocs-tip" id="fs17">type &#39;T list = List&lt;&#39;T&gt;</div>
<div class="fsdocs-tip" id="fs18">type unit = Unit</div>

    </div>
</main>
<aside id="fsdocs-page-menu">
    <p id="on-this-page">On this page</p>
    <ul>
  <li class="level-1">
    <a href="#Parameter-System-Documentation">
      Parameter System Documentation
    </a>
  </li>
  <li class="level-2">
    <a href="#Overview">
      Overview
    </a>
  </li>
  <li class="level-2">
    <a href="#Key-Features">
      Key Features
    </a>
  </li>
  <li class="level-2">
    <a href="#Architecture">
      Architecture
    </a>
  </li>
  <li class="level-4">
    <a href="#Basic-Types">
      Basic Types
    </a>
  </li>
  <li class="level-4">
    <a href="#Expression-AST">
      Expression AST
    </a>
  </li>
  <li class="level-4">
    <a href="#Constraints">
      Constraints
    </a>
  </li>
  <li class="level-4">
    <a href="#Component-Slots">
      Component Slots
    </a>
  </li>
  <li class="level-4">
    <a href="#Sheet-Level-Definitions">
      Sheet-Level Definitions
    </a>
  </li>
  <li class="level-4">
    <a href="#Sheet-Parameter-Management">
      Sheet Parameter Management
    </a>
  </li>
  <li class="level-4">
    <a href="#Component-Parameter-Binding">
      Component Parameter Binding
    </a>
  </li>
  <li class="level-4">
    <a href="#Parameter-Evaluation">
      Parameter Evaluation
    </a>
  </li>
  <li class="level-4">
    <a href="#Stage-1-Graph-Merging">
      Stage 1 - Graph Merging
    </a>
  </li>
  <li class="level-4">
    <a href="#Stage-2-Parameter-Resolution">
      Stage 2 - Parameter Resolution
    </a>
  </li>
  <li class="level-2">
    <a href="#Data-Flow">
      Data Flow
    </a>
  </li>
  <li class="level-3">
    <a href="#1-Parameter-Definition-Flow">
      1. Parameter Definition Flow
    </a>
  </li>
  <li class="level-3">
    <a href="#2-Component-Parameterization-Flow">
      2. Component Parameterization Flow
    </a>
  </li>
  <li class="level-3">
    <a href="#3-Simulation-Resolution-Flow">
      3. Simulation Resolution Flow
    </a>
  </li>
  <li class="level-3">
    <a href="#4-Custom-Component-Flow">
      4. Custom Component Flow
    </a>
  </li>
  <li class="level-2">
    <a href="#Expression-Language">
      Expression Language
    </a>
  </li>
  <li class="level-3">
    <a href="#Syntax-Elements">
      Syntax Elements
    </a>
  </li>
  <li class="level-3">
    <a href="#Example-Expressions">
      Example Expressions
    </a>
  </li>
  <li class="level-3">
    <a href="#Parser-Implementation">
      Parser Implementation
    </a>
  </li>
  <li class="level-2">
    <a href="#Parameter-Scoping-amp-Precedence">
      Parameter Scoping &amp; Precedence
    </a>
  </li>
  <li class="level-3">
    <a href="#Scope-Levels">
      Scope Levels
    </a>
  </li>
  <li class="level-3">
    <a href="#Precedence-Rules-highest-to-lowest">
      Precedence Rules (highest to lowest)
    </a>
  </li>
  <li class="level-3">
    <a href="#Example-Scenario">
      Example Scenario
    </a>
  </li>
  <li class="level-2">
    <a href="#Constraint-System">
      Constraint System
    </a>
  </li>
  <li class="level-3">
    <a href="#Constraint-Definition">
      Constraint Definition
    </a>
  </li>
  <li class="level-3">
    <a href="#Features">
      Features
    </a>
  </li>
  <li class="level-3">
    <a href="#Example">
      Example
    </a>
  </li>
  <li class="level-2">
    <a href="#Three-Tier-Evaluation-Architecture">
      Three-Tier Evaluation Architecture
    </a>
  </li>
  <li class="level-2">
    <a href="#Persistence">
      Persistence
    </a>
  </li>
  <li class="level-3">
    <a href="#File-Storage">
      File Storage
    </a>
  </li>
  <li class="level-3">
    <a href="#Runtime-State">
      Runtime State
    </a>
  </li>
  <li class="level-2">
    <a href="#Component-Support">
      Component Support
    </a>
  </li>
  <li class="level-3">
    <a href="#Currently-Parameterizable-Components">
      Currently Parameterizable Components
    </a>
  </li>
  <li class="level-4">
    <a href="#Width-Configurable-Components">
      Width-Configurable Components
    </a>
  </li>
  <li class="level-4">
    <a href="#Custom-Components">
      Custom Components
    </a>
  </li>
  <li class="level-4">
    <a href="#I-O-Components">
      I/O Components
    </a>
  </li>
  <li class="level-4">
    <a href="#Constants">
      Constants
    </a>
  </li>
  <li class="level-3">
    <a href="#Adding-Parameter-Support-to-New-Components">
      Adding Parameter Support to New Components
    </a>
  </li>
  <li class="level-2">
    <a href="#Usage-Examples">
      Usage Examples
    </a>
  </li>
  <li class="level-3">
    <a href="#Example-1-Define-Sheet-Parameter">
      Example 1: Define Sheet Parameter
    </a>
  </li>
  <li class="level-3">
    <a href="#Example-2-Use-Parameter-in-Component">
      Example 2: Use Parameter in Component
    </a>
  </li>
  <li class="level-3">
    <a href="#Example-3-Override-in-Custom-Component">
      Example 3: Override in Custom Component
    </a>
  </li>
  <li class="level-3">
    <a href="#Example-4-Complex-Expression">
      Example 4: Complex Expression
    </a>
  </li>
  <li class="level-2">
    <a href="#Error-Handling">
      Error Handling
    </a>
  </li>
  <li class="level-3">
    <a href="#Parse-Errors">
      Parse Errors
    </a>
  </li>
  <li class="level-3">
    <a href="#Evaluation-Errors">
      Evaluation Errors
    </a>
  </li>
  <li class="level-3">
    <a href="#Constraint-Violations">
      Constraint Violations
    </a>
  </li>
  <li class="level-3">
    <a href="#Type-Errors">
      Type Errors
    </a>
  </li>
  <li class="level-2">
    <a href="#Implementation-Details">
      Implementation Details
    </a>
  </li>
  <li class="level-3">
    <a href="#Optics-Lenses-Pattern">
      Optics/Lenses Pattern
    </a>
  </li>
  <li class="level-3">
    <a href="#Message-Dispatch">
      Message Dispatch
    </a>
  </li>
  <li class="level-3">
    <a href="#Functional-Patterns">
      Functional Patterns
    </a>
  </li>
  <li class="level-2">
    <a href="#Testing-amp-Debugging">
      Testing &amp; Debugging
    </a>
  </li>
  <li class="level-3">
    <a href="#Debug-Helpers">
      Debug Helpers
    </a>
  </li>
  <li class="level-3">
    <a href="#Common-Issues">
      Common Issues
    </a>
  </li>
  <li class="level-2">
    <a href="#Future-Extensions">
      Future Extensions
    </a>
  </li>
  <li class="level-3">
    <a href="#Type-System">
      Type System
    </a>
  </li>
  <li class="level-3">
    <a href="#Advanced-Features">
      Advanced Features
    </a>
  </li>
  <li class="level-3">
    <a href="#UI-Improvements">
      UI Improvements
    </a>
  </li>
  <li class="level-2">
    <a href="#API-Reference">
      API Reference
    </a>
  </li>
  <li class="level-3">
    <a href="#Key-Functions">
      Key Functions
    </a>
  </li>
  <li class="level-4">
    <a href="#Expression-Parsing">
      Expression Parsing
    </a>
  </li>
  <li class="level-4">
    <a href="#Expression-Evaluation">
      Expression Evaluation
    </a>
  </li>
  <li class="level-4">
    <a href="#Expression-Rendering">
      Expression Rendering
    </a>
  </li>
  <li class="level-4">
    <a href="#Parameter-Resolution">
      Parameter Resolution
    </a>
  </li>
  <li class="level-4">
    <a href="#Constraint-Checking">
      Constraint Checking
    </a>
  </li>
  <li class="level-2">
    <a href="#Best-Practices">
      Best Practices
    </a>
  </li>
  <li class="level-2">
    <a href="#Troubleshooting">
      Troubleshooting
    </a>
  </li>
  <li class="level-3">
    <a href="#Parameter-Not-Found">
      Parameter Not Found
    </a>
  </li>
  <li class="level-3">
    <a href="#Expression-Parse-Error">
      Expression Parse Error
    </a>
  </li>
  <li class="level-3">
    <a href="#Constraint-Violation">
      Constraint Violation
    </a>
  </li>
  <li class="level-3">
    <a href="#Simulation-Failure">
      Simulation Failure
    </a>
  </li>
</ul>
</aside>
<dialog>
    <input type="search" placeholder="Search docs" />
    <div class="results">
        <ul></ul>
        <p class="empty">Type something to start searching.</p>
    </div>
</dialog>
<script type="module" src="/issie/content/fsdocs-tips.js"></script>
<script type="module" src="/issie/content/fsdocs-theme-toggle.js"></script>
<script type="module" src="/issie/content/fsdocs-details-toggle.js"></script>
<script type="module" src="/issie/content/fsdocs-theme.js"></script>
<script type="module" src="/issie/content/fsdocs-search.js"></script>

</body>
</html>